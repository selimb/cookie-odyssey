{#
Idea inspired by https://themurph.hashnode.dev/go-beyond-the-basics-mastering-toast-notifications-with-go-and-htmx
#}

<div id="toast-container">
  <template>
    <div class="toast notification" role="alert">
      <div class="toast--text"></div>
      <button type="button" class="delete">
    </div>
  </template>
</div>

<script>
  (() => {
    // Keep in sync with [toast]
    const TOAST_EVT = "app.toast";
    /**
     * @typedef Toast
     * @type {object}
     * @property {string} message
     * @property {string} class
     * @property {boolean} auto_close
     */

    /** @param data {Toast} */
    function makeToast(data) {
      /** @type {DocumentFragment} */
      const clone = $template.content.cloneNode(true);
      const $toast = clone.querySelector("div");
      $toast.classList.add(data.class);
      $toast.querySelector(".toast--text").textContent = data.message;
      return $toast;
    }

    function handleToastEvent(evt) {
      /** @type {Toast} */
      const detail = evt.detail;
      const $toast = makeToast(evt.detail);
      $toastContainer.appendChild($toast);

      const remove = () => {
        $toast.remove();
      };


      if (detail.auto_close) {
        setTimeout(remove, 5000);
      }
      $toast.querySelector("button").addEventListener("click", remove);
    }

    const $toastContainer = document.getElementById("toast-container");
    const $template = $toastContainer.getElementsByTagName("template")[0];
    document.body.addEventListener("app.toast", handleToastEvent);
  })()
</script>

<style>
  #toast-container {
    position: absolute;
    bottom: 0;
    right: 0;
    margin: 1rem;
    display: flex;
    flex-direction: column;
    gap: 1rem;
  }

  @media only screen and (max-width: 768px) {
    #toast-container {
      bottom: unset;
      /* Below navbar */
      top: 48px;
      left: 0;
    }
  }

  #toast-container .toast {
    /* Override bulma's margin-bottom. */
    margin-bottom: 0;
  }

  #toast-container .toast--text {
    /* Enough space for the X not to be on top of text */
    padding-right: 24px;
  }
</style>