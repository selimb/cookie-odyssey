{#
Idea inspired by https://themurph.hashnode.dev/go-beyond-the-basics-mastering-toast-notifications-with-go-and-htmx
#}

<div class="toast max-md:toast-top max-md:w-full" id="toast-container">
  <template>
    <div class="alert flex justify-between items-center" role="alert">
      <div data-text=""></div>
      <!-- https://flowbite.com/docs/components/toast/#default-toast -->
      <button type="button" class="btn btn-circle btn-outline btn-sm bg-" aria-label="Close">
        <span class="sr-only">Close</span>
        <svg class="w-3 h-3" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 14 14">
          <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
            d="m1 1 6 6m0 0 6 6M7 7l6-6M7 7l-6 6" />
        </svg>
      </button>
    </div>
  </template>
</div>

<script>
  (() => {
    // Keep in sync with [toast]
    const TOAST_EVT = "app.toast";

    /** @type {Record<Toast["variant"], {alert: string[], button: string[]}>} */
    const variants = {
      error: {
        alert: "alert-error".split(" "),
        button: "border-error-content text-error-content hover:bg-error-content hover:border-error hover:text-error".split(" ")
      },
      success: {
        alert: "alert-success".split(" "),
        button: "border-success-content text-success-content hover:bg-success-content hover:border-success hover:text-success".split(" ")
      },
    };

    /**
     * @typedef Toast
     * @type {object}
     * @property {string} message
     * @property {"sucess" | "error"} variant
     * @property {boolean} auto_close
     */

    /** @param data {Toast} */
    function makeToast(data) {
      console.info(data);
      /** @type {DocumentFragment} */
      const clone = $template.content.cloneNode(true);
      const $toast = clone.querySelector("div");
      const classNames = variants[data.variant];
      $toast.classList.add(...classNames.alert);
      $toast.querySelector("[data-text]").textContent = data.message;
      $toast.querySelector("button").classList.add(...classNames.button);
      return $toast;
    }

    function handleToastEvent(evt) {
      /** @type {Toast} */
      const detail = evt.detail;
      const $toast = makeToast(evt.detail);
      $toastContainer.appendChild($toast);

      const remove = () => {
        $toast.remove();
      };


      if (detail.auto_close) {
        setTimeout(remove, 5000);
      }
      $toast.querySelector("button").addEventListener("click", remove);
    }

    const $toastContainer = document.getElementById("toast-container");
    const $template = $toastContainer.getElementsByTagName("template")[0];
    document.body.addEventListener(TOAST_EVT, handleToastEvent);
  })()
</script>

<style>
  #toast-container .toast {
    /* Override bulma's margin-bottom. */
    margin-bottom: 0;
  }

  #toast-container .toast--text {
    /* Enough space for the X not to be on top of text */
    padding-right: 24px;
  }
</style>