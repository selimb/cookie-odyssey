<!-- <link
  rel="stylesheet"
  href="https://unpkg.com/photoswipe@5.2.2/dist/photoswipe.css"
/> -->

<script type="module">
  // @ts-check
  /// <reference path="./js_utils.d.ts" />
  /// <reference path="./media.d.ts" />
  /// <reference path="./theme.d.ts" />

  window.jsUtils.once("media", () => {
    function bindFancybox($gallery) {
      console.info("bindFancybox", window.theme.value, $gallery);
      // window.Fancybox.destroy();
      if ($gallery) {
        window.Fancybox.bind($gallery, "[data-fancybox]", {
          zoomEffect: false,
          theme: window.theme.value,
        });
      }
    }

    function init() {
      bindFancybox(document.querySelector("[data-fancybox-gallery]"));
    }

    init();

    // Assumes there's always only one gallery per page.
    // window.jsUtils.observe("[data-fancybox-gallery]", ($gallery) => {
    //   bindFancybox($gallery);
    // });

    // window.theme.onChange(function rebindFancybox() {
    //   init();
    // });
  });

  // XXX types
  // import PhotoSwipeLightbox from "https://unpkg.com/photoswipe@5/dist/photoswipe-lightbox.esm.js?module";
  // import PhotoSwipe from "https://unpkg.com/photoswipe@5/dist/photoswipe.esm.js?module";

  // const lightbox = new PhotoSwipeLightbox({
  //   gallery: "[data-pswp-gallery-target]",
  //   children: "a[data-pswp-children]",
  //   showHideAnimationType: "none",
  //   pswpModule: PhotoSwipe,
  // });

  // lightbox.init();
</script>

{% macro media_tag(media, class) %}
  {% if media.media_type == "image" %}
    <a
      href="{{ media.url_original }}"
      data-fancybox="gallery"
      data-pswp-width="{{ media.width_original }}"
      data-pswp-height="{{ media.height_original }}"
      target="_blank"
    >
      <img src="{{ media.url_thumbnail }}" alt="media" class="{{ class }}" />
    </a>
  {% else %}
    <!-- XXX -->
    <video src="{{ media.url }}" controls class="{{ class }}">
      Your browser does not support the video tag.
    </video>
  {% endif %}
{% endmacro %}
